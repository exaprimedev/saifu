<!doctype html>
<html lang="ja">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <style>
        html,
        body {
            font-size: small;
            height: 100%;
            margin: 0;
        }
        
        .wrapper {
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .header,
        .footer {
            background: silver;
        }
        
        .content {
            flex: 1;
            overflow: auto;
        }
    </style>
    <title>routedb</title>
</head>

<body>
    <div class="wrapper">
        <div class="header">
            <div class="card w-100">
                <div class="card-header" style="padding:.3rem 1rem;">
                    <strong>
                        <span id="bakaze">東</span><span id="kyoku">1</span>局：<span id="honba">0</span>本場：ドラ：<img style="width:14px;height:auto;" src="imgs/p2.png"><span id="oya">：親</span>：丸山まるこ
                    </strong>
                </div>
                <div class="card-body text-center">
                    <div id="kawa" class="w-100" style="text-align: left;">
                    </div>
                </div>
            </div>
            <div id="tehai" style="margin-bottom:-15px;">
            </div>
        </div>
        <div class="content">
            <div style="height:1000px;">
                <input type="hidden" id="hid_tehai" name="hid_tehai">
                <input type="hidden" id="hid_status" name="hid_status" value="haipai">
                <input type="hidden" id="hid_jyunme" name="hid_jyunme" value="1">
                <div id="history" style="margin-bottom:-15px;">
                </div>
                <div class="modal" tabindex="-1" role="dialog" id="tehai_confirm_modal">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">配牌確認</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="閉じる">
                                        <span aria-hidden="true">×</span>
                                    </button>
                            </div>
                            <div class="modal-body" id="tehai_confirm_modal_body">
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="modalOK()">OK</button>
                                <button type="button" class="btn btn-secondaryprimary" id="modal_close" onclick="modalClear()">クリア</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="footer">
            <div class="card w-100">
                <div class="text-center">
                    <div id="inputpai_m" class="w-100" style="text-align: center;">
                    </div>
                    <div id="inputpai_p" class="w-100" style="text-align: center;">
                    </div>
                    <div id="inputpai_s" class="w-100" style="text-align: center;">
                    </div>
                    <div id="inputpai_z" class="w-100" style="text-align: center;">
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin=" anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
    ‘
    <!-- Optional JavaScript -->
    <script>
        var w = 0;
        var inputpai_w = 0;
        var tehai_w = 0;
        var tehai_w_h = 0;
        var kawa_w = 0;
        var kawa_w_h = 0;
        var arr_tehai = [];
        $(function() {
            w = $(window).width();
            inputpai_w = w * 0.099;
            tehai_w = w * 0.062;
            tehai_w_h = w * 0.085;
            kawa_w = w * 0.041;
            kawa_w_h = w * 0.085;
            console.log(w + ":" + inputpai_w);
            var inputpai_m_out = "";
            var inputpai_p_out = "";
            var inputpai_s_out = "";
            var inputpai_z_out = "";
            for (var idx = 1; idx < 10; idx++) {
                inputpai_m_out += '<div style="float:left;" data-toggle="tooltip" title="m' + idx + '"><a href="#" id="m' + idx + '" onclick="selectPai(this)"><img id="img_m' + idx + '" style="width:' + inputpai_w + 'px;height:auto;" src="imgs/m' + idx + '.png"></a></div>';
                inputpai_p_out += '<div style="float:left;" data-toggle="tooltip" title="p' + idx + '"><a href="#" id="p' + idx + '" onclick="selectPai(this)"><img id="img_p' + idx + '" style="width:' + inputpai_w + 'px;height:auto;" src="imgs/p' + idx + '.png"></a></div>';
                inputpai_s_out += '<div style="float:left;" data-toggle="tooltip" title="s' + idx + '"><a href="#" id="s' + idx + '" onclick="selectPai(this)"><img id="img_s' + idx + '" style="width:' + inputpai_w + 'px;height:auto;" src="imgs/s' + idx + '.png"></a></div>';
            }
            inputpai_m_out += '<div style="float:left;" data-toggle="tooltip" title="m5r"><a href="#" id="m5r" onclick="selectPai(this)"><img id="img_m' + idx + '" style="width:' + inputpai_w + 'px;height:auto;" src="imgs/m5r.png"></a></div>';
            inputpai_p_out += '<div style="float:left;" data-toggle="tooltip" title="p5r"><a href="#" id="p5r" onclick="selectPai(this)"><img id="img_p' + idx + '" style="width:' + inputpai_w + 'px;height:auto;" src="imgs/p5r.png"></a></div>';
            inputpai_s_out += '<div style="float:left;" data-toggle="tooltip" title="s5r"><a href="#" id="s5r" onclick="selectPai(this)"><img id="img_s' + idx + '" style="width:' + inputpai_w + 'px;height:auto;" src="imgs/s5r.png"></a></div>';
            for (var idx = 1; idx < 8; idx++) {
                inputpai_z_out += '<div style="float:left;" data-toggle="tooltip" title="z' + idx + '"><a href="#" id="z' + idx + '" onclick="selectPai(this)"><img id="img_z' + idx + '" style="width:' + inputpai_w + 'px;height:auto;" src="imgs/z' + idx + '.png"></a></div>';
            }
            $("#inputpai_m").html(inputpai_m_out);
            $("#inputpai_p").html(inputpai_p_out);
            $("#inputpai_s").html(inputpai_s_out);
            $("#inputpai_z").html(inputpai_z_out);
            $('[data-toggle="tooltip"]').tooltip();
        });

        function selectPai(elm) {
            var tehai = $("#tehai").html();
            var kawa = $("#kawa").html();
            var history = $("#history").html();
            var markHistory = '<figure style="display:inline-block;"><figcaption style="text-align:center;font-size:80%;">▲</figcaption>';
            if ($("#hid_status").val() == "haipai") {
                if (arr_tehai.length <= 13) {
                    arr_tehai.push(elm.id)
                    tehai += elm.innerHTML.replace(inputpai_w, tehai_w);
                    $("#tehai").html(tehai);
                    if (arr_tehai.length == 13) {
                        $("#tehai_confirm_modal_body").html($("#tehai").html());
                        $("#tehai_confirm_modal").modal();
                    }
                    $("#hid_tehai").val(arr_tehai.join());
                }
            } else if ($("#hid_status").val() == "tsumo") {
                if (checkNaki(elm.id)) {

                } else {
                    arr_tehai.push(elm.id);
                    var jyunme = $("#hid_jyunme").val();
                    tehai += '<figure style="display:inline-block;"><figcaption id="figc_' + $("#hid_jyunme").val() + "_" + elm.id + '" style="text-align:center;font-size:80%;"></figcaption>';
                    tehai += elm.innerHTML.replace(inputpai_w, tehai_w);
                    tehai += '</figure>';
                    $("#hid_jyunme").val(Number(jyunme) + 1);
                    $("#tehai").html(tehai);
                    $("#hid_status").val("kiri");
                    $("#hid_tehai").val(arr_tehai.join());
                }
            } else {
                console.log($("#hid_tehai").val())
                arr_tehai = $("#hid_tehai").val().split(',');
                arr_tehai.splice($.inArray(elm.id, arr_tehai), 1);
                $("#history").html($("#tehai").html() + "<br>" + history);
                $("#hid_tehai").val(arr_tehai.join());
                console.log($("#hid_tehai").val())
                $("#tehai").html(sortTehai(elm.id));
                $("#figc_" + String(Number($("#hid_jyunme").val()) - 1) + "_" + elm.id).html("▲");
                var markKawa = '<figure style="display:inline-block;"><figcaption id="k_figc_' + String(Number($("#hid_jyunme").val()) - 1) + "_" + elm.id + '" style="text-align:center;font-size:80%;"></figcaption>'
                $("#kawa").html(kawa + markKawa + elm.innerHTML.replace(inputpai_w, kawa_w) + '</figure>');
                $("#k_figc_" + String(Number($("#hid_jyunme").val()) - 1) + "_" + elm.id).html("");
                $("#hid_status").val("tsumo");
            }
            console.log(arr_tehai);
        }

        function modalOK() {
            $("#tehai_confirm_modal").modal('hide');
            $("#tehai").html(sortTehai());
            $("#hid_status").val("tsumo");
        }

        function modalClear() {
            $("#tehai").html("");
            $("#hid_tehai").val("");
            arr_tehai = [];
            $("#tehai_confirm_modal").modal('hide');
        }

        function sortTehai(pai) {
            arr_tehai = $("#hid_tehai").val().split(',');
            arr_tehai.sort();
            var tehai = "";
            for (var idx in arr_tehai) {
                tehai += '<figure style="display:inline-block;"><figcaption id="figc_' + $("#hid_jyunme").val() + "_" + arr_tehai[idx] + '" style="text-align:center;font-size:80%;">';
                tehai += '</figcaption>';
                tehai += '<img id="img_' + arr_tehai[idx] + '" style="width:' + inputpai_w + 'px;height:auto;" src="imgs/' + arr_tehai[idx] + '.png"></figure>';
            }
            return tehai.split(inputpai_w).join(tehai_w);
        }

        function checkNaki(pai) {
            console.log(pai);
            return false;
        }
    </script>
</body>

</html>